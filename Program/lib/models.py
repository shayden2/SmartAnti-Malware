from joblib import load
import pefile

def bitmap_model(file, imports):
    bitmap = ''
    try:
        dlls = set()
        pe = pefile.PE(file, fast_load = True)
        pe.parse_data_directories()
        for entry in pe.DIRECTORY_ENTRY_IMPORT:
            dlls.add(entry.dll.decode().lower())       
    except:
        print('Blacklisted')
        return

    for dll in imports:
        if dll in dlls:
            bitmap += '1'
        else:
            bitmap += '0'

    clf = load('../data/av-model.joblib')
    return(clf.predict([list(bitmap)])[0])

def virustotal_model(file, imports):
    return 'Success'

def ngrams_model(file, imports):
    return 'Success'