import numpy as np
import pandas as pd
import pefile
from itertools import islice

def ngrams(input, n):
    output = []
    for i in range(len(input)-n+1):
        output.append(input[i:i+n])
    return output

""" Preprocess Training Data """

df=pd.read_csv('../malware/train.csv',encoding = "ISO-8859-1")
print(df.head())
train_y = []
train_x = []
binary = []
for fn in df['id'].values:
    with open(f'../malware/train/{fn}',"rb") as f:
        data = f.read()
        # data = list(data)
        train_x.append(data)
        print(f"Reading: {fn}")
        if df.loc[df['id']==fn]['list'].item() == "Blacklist":
            train_y.append(1)
        elif df.loc[df['id']==fn]['list'].item() == "Whitelist":
            train_y.append(0)

""" Preprocess Testing Data """

df=pd.read_csv('../malware/test.csv',encoding = "ISO-8859-1")
test_y = []
test_x = []
binary = []
for fn in df['id'].values:
    with open(f'../malware/test/{fn}',"rb") as f:
        data = f.read()
        # data = list(data)
        test_x.append(data)
        print(f"Reading: {fn}")
        if df.loc[df['id']==fn]['list'].item() == "Blacklist":
            test_y.append(1)
        elif df.loc[df['id']==fn]['list'].item() == "Whitelist":
            test_y.append(0)


""" Write CSV with Train Data """

print("Creating train csv...")

data = {"text": train_x, 'label': train_y}

df = pd.DataFrame(data)

df.to_csv('train_data.csv')

""" Write CSV with Test Data """

print("Creating test csv...")

data = {"text": test_x, 'label': test_y}

df = pd.DataFrame(data)

df.to_csv('test_data.csv')
