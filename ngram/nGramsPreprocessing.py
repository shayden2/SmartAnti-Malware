import numpy as np
import pandas as pd
import pefile
from itertools import islice

def ngrams(input, n):
    output = []
    for i in range(len(input)-n+1):
        output.append(input[i:i+n])
    return output

""" Preprocess Training Data """

df=pd.read_csv('../malware/train.csv',encoding = "ISO-8859-1")
print(df.head())
train_y = []
train_x = []
binary = []
for fn in df['id'].values:
    if fn%10 == 0:
        with open(f'../malware/train/{fn}',"rb") as f:
            data = f.read()
            data = list(data)
            binary.append(data)
            print(f"Reading: {fn}")
            train_y.append(df.loc[df['id']==fn]['list'].item())



for arr in binary:
    tg = ngrams(arr, 3)
    train_x.append(tg)


""" Preprocess Testing Data """

df=pd.read_csv('../malware/test.csv',encoding = "ISO-8859-1")
test_y = []
test_x = []
binary = []
for fn in df['id'].values:
    if fn%10 == 0:
        with open(f'../malware/test/{fn}',"rb") as f:
            data = f.read()
            data = list(data)
            binary.append(data)
            print(f"Reading: {fn}")
            test_y.append(df.loc[df['id']==fn]['list'].item())



for arr in binary:
    tg = ngrams(arr, 3)
    test_x.append(tg)

""" Write CSV with Train Data """

print("Creating train csv...")

data = {"trainX": train_x, 'trainY': train_y}

df = pd.DataFrame(data)

df.to_csv('ngrams_train.csv')

""" Write CSV with Test Data """

print("Creating test csv...")

data = {"testX": test_x, 'testY': test_y}

df = pd.DataFrame(data)

df.to_csv('ngrams_test.csv')
