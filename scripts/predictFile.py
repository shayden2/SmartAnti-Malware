from joblib import load
import pefile
import sys

def main():
    target = sys.argv[1]
    imports = list()

    with open('../data/imports.txt', 'r') as f:
        for dll in f:
            imports.append(dll.rstrip())
    bitmap = ''
    try:
        dlls = set()
        pe = pefile.PE(f'../malware/train/{target}', fast_load = True)
        pe.parse_data_directories()
        for entry in pe.DIRECTORY_ENTRY_IMPORT:
            dlls.add(entry.dll.decode().lower())       
    except:
        print('Blacklisted')
        return

    for dll in imports:
        if dll in dlls:
            bitmap += '1'
        else:
            bitmap += '0'

    clf = load('../data/av-model.joblib')
    print(clf.predict([list(bitmap)])[0])

if __name__ == '__main__':
    main()